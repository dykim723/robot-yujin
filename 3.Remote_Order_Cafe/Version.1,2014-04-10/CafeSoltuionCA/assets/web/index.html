<!doctype html>
<html>
<head>
    <title>Cafe Solution</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--
    <link rel="stylesheet" href="./lib/jquery.mobile-1.4.2/jquery.mobile-1.4.2.min.css">
    -->

    <link rel="stylesheet" href="file:///android_asset/web/lib/jquery.mobile-1.4.2/jquery.mobile-1.4.2.min.css">
    <!--
    -->

    <style>
        #page {
            width: 100%;
            height: 100%;
            padding: 0;
        }

        #map-canvas {
            width: 100%;
            height: 200px;
        }

        ul.list-hor {
            list-style: none;
            width: 100%;
            display: block;
        }

        ul.list-hor > li {
            width: 200px;
            list-style: none;
            float: left;
        }

        .menuitem {
            width: 100%;
        }

        div.menuitem-blk {
            text-align: center;
            font-weight: bold;
        }

        input.in-small {
            width: 40px;
        }

        .hor-children > * {
            float: left;
        }
    </style>

</head>
<body>

<div data-role="page" id="page" data-url="page">
    <div data-role="header" data-theme="a">
        <h1>Cafe Solution</h1>
    </div>
    <div role="main" class="ui-content" id="map-canvas">
        <!-- map loads here... -->
    </div>
    <div class="ui-corner-all custom-corners">
        <div class="ui-bar ui-bar-a">
            <h3>Menu</h3>
        </div>
        <ul data-role="listview" data-inset="true">
            <li data-icon="false">
                <img src="file:///android_asset/web/res/americano.png">

                <div style="float:left">
                    <h2>Americano</h2>

                    <p>2,000 won</p>
                </div>
                <div style="float:right">
                    <div class="ui-nodisc-icon hor-children"><!-- Class added to the wrapper -->
                        <a href="#"
                           class="btn-minus ui-btn ui-shadow ui-corner-all ui-icon-minus ui-btn-icon-notext ui-btn-b ui-btn-inline">Minus</a>
                        <input readonly="readonly" value="0" class="in-small">
                        <a href="#"
                           class="btn-plus ui-btn ui-shadow ui-corner-all ui-icon-plus ui-btn-icon-notext ui-btn-b ui-btn-inline">Plus</a>
                    </div>
                </div>
            </li>
            <li data-icon="false">
                <img src="file:///android_asset/web/res/iced-americano.png">

                <div style="float:left">
                    <h2>Iced Americano</h2>

                    <p>2,500 won</p>
                </div>
                <div style="float:right">
                    <div class="ui-nodisc-icon hor-children"><!-- Class added to the wrapper -->
                        <a href="#"
                           class="btn-minus ui-btn ui-shadow ui-corner-all ui-icon-minus ui-btn-icon-notext ui-btn-b ui-btn-inline">Minus</a>
                        <input readonly="readonly" value="0" class="in-small">
                        <a href="#"
                           class="btn-plus ui-btn ui-shadow ui-corner-all ui-icon-plus ui-btn-icon-notext ui-btn-b ui-btn-inline">Plus</a>
                    </div>
                </div>

            </li>
            <li data-icon="false">
                <img src="file:///android_asset/web/res/cafe-latte.png">

                <div style="float:left">
                    <h2>Latte</h2>

                    <p>2,500 won</p>
                </div>
                <div style="float:right">
                    <div class="ui-nodisc-icon hor-children"><!-- Class added to the wrapper -->
                        <a href="#"
                           class="btn-minus ui-btn ui-shadow ui-corner-all ui-icon-minus ui-btn-icon-notext ui-btn-b ui-btn-inline">Minus</a>
                        <input readonly="readonly" value="0" class="in-small">
                        <a href="#"
                           class="btn-plus ui-btn ui-shadow ui-corner-all ui-icon-plus ui-btn-icon-notext ui-btn-b ui-btn-inline">Plus</a>
                    </div>
                </div>
            </li>
            <li data-icon="false">
                <img src="file:///android_asset/web/res/iced_cafe-latte.png">

                <div style="float:left">
                    <h2>Iced Latte</h2>

                    <p>3,000 won</p>
                </div>
                <div style="float:right">
                    <div class="ui-nodisc-icon hor-children"><!-- Class added to the wrapper -->
                        <a href="#"
                           class="btn-minus ui-btn ui-shadow ui-corner-all ui-icon-minus ui-btn-icon-notext ui-btn-b ui-btn-inline">Minus</a>
                        <input readonly="readonly" value="0" class="in-small">
                        <a href="#"
                           class="btn-plus ui-btn ui-shadow ui-corner-all ui-icon-plus ui-btn-icon-notext ui-btn-b ui-btn-inline">Plus</a>
                    </div>
                </div>
            </li>
        </ul>

        <!--div class="ui-body ui-body-a">
            <ul class="list-hor">
                <li><div class="menuitem-blk"><img class="menuitem" src="file:///android_asset/web/res/americano.png"><br>Americano</div></li>
                <li><div class="menuitem-blk"><img class="menuitem" src="file:///android_asset/web/res/iced-americano.png"><br>Iced Americano</div></li>
                <li><div class="menuitem-blk"><img class="menuitem" src="file:///android_asset/web/res/cafe-latte.png"><br>Latte</div></li>
                <li><div class="menuitem-blk"><img class="menuitem" src="file:///android_asset/web/res/iced_cafe-latte.png"><br>Iced Latte</div></li>
            </ul>
        </div-->
    </div>
    <button class="ui-btn" id="btn-order">Order</button>
    <label>Expected Arrival Time:</label><input readonly="readonly" id="arrival-time">
</div>

<!--
-->
<script src="file:///android_asset/web/lib/jquery-1.11.0.min.js"></script>
<script src="file:///android_asset/web/lib/jquery.mobile-1.4.2/jquery.mobile-1.4.2.min.js"></script>
<!--
<script src="./lib/jquery-1.11.0.min.js"></script>
<script src="./lib/jquery.mobile-1.4.2/jquery.mobile-1.4.2.min.js"></script>
-->
<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript">
    /*
     * Google Maps documentation: http://code.google.com/apis/maps/documentation/javascript/basics.html
     * Geolocation documentation: http://dev.w3.org/geo/api/spec-source.html
     */
    $(document).on("pageinit", "#page", function () {
        $("#btn-order").click(order);
        $(".btn-minus").click(function () {
            numIn = $(this).parent().find("input.in-small");
            num = Number(numIn.attr("value"));
            if (num > 0) {
                numIn.attr("value", num - 1);
            }
        });
        $(".btn-plus").click(function () {
            numIn = $(this).parent().find("input.in-small");
            num = Number(numIn.attr("value"));
            numIn.attr("value", num + 1);
        });

        // Location of Soongsil Univ.: 37.496375,126.956879
        var lastLocation = new google.maps.LatLng(37.496375, 126.956879); // Soongsil Univ.
        var directionsDisplay = new google.maps.DirectionsRenderer();
        var directionsService = new google.maps.DirectionsService();

        if (navigator.geolocation) {
            function success(pos) {
                // Location found, show map with these coordinates
                lastLocation = new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
                drawMap(lastLocation);
            }

            function fail(error) {
                drawMap(lastLocation);  // Failed to find location, show default map
            }

            // Find the users current position.  Cache the location for 5 minutes, timeout after 6 seconds
            navigator.geolocation.getCurrentPosition(success, fail, {maximumAge: 500000, enableHighAccuracy: true, timeout: 6000});
        } else {
            drawMap(defaultLatLng);  // No geolocation support, show default map
        }

        function packOrderMenu() {
            $("input.in-small").each(function() {
               alert($(this).attr("value"));
            });
        }

        function order() {
            calcRoute();
            packOrderMenu();
        }

        function calcRoute() {
            // Location of the cafe: 37.476025,126.882318
            var end = new google.maps.LatLng(37.476025, 126.882318);

            var request = {
                origin: lastLocation,
                destination: end,
                provideRouteAlternatives: false,
                travelMode: google.maps.TravelMode.TRANSIT
            };

            directionsService.route(request, function (response, status) {
                // alert(status);
                if (status == google.maps.DirectionsStatus.OK) {
                    directionsDisplay.setDirections(response);
                    // alert(JSON.stringify(response));
                    // Time Zone: response.routes[0].legs[0].arrival_time.time_zone
                    // Value: response.routes[0].legs[0].arrival_time.value
                    arrivalTime = new Date(response.routes[0].legs[0].arrival_time.value);
                    // Math.abs(arrivalTime-new Date());
                    $("#arrival-time").attr("value", arrivalTime);
                }
            });
        }

        function drawMap(latlng, isForRoute) {
            var myOptions = {
                zoom: 10,
                center: latlng,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            var map = new google.maps.Map(document.getElementById("map-canvas"), myOptions);
            directionsDisplay.setMap(map);

            if (isForRoute == undefined || !isForRoute) {
                // Add an overlay to the map of current lat/lng
                var marker = new google.maps.Marker({
                    position: latlng,
                    map: map,
                    title: "Greetings!"
                });
            }
        }
    });
</script>
</body>
</html>